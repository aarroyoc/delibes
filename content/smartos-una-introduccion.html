Hoy vamos a probar <a href="http://smartos.org">SmartOS</a>. SmartOS es el sistema operativo de Joyent para aplicaciones cloud. Usa un kernel <a href="http://wiki.illumos.org/display/illumos/illumos+Home">illumos</a> (fork de OpenSolaris cuando Oracle cerró el proyecto, a nivel técnico comparte mucho con Solaris 10) y usa extensivamente características únicas de Solaris. Además, es el único illumos que tiene KVM, una característica de Linux para permitir virtualización de alto rendimiento.<br><h2>Descargando SmartOS</h2><br>Lo primero que tenemos que hacer para probar SmartOS es descargarlo. Lo podemos descargar desde <a href="http://smartos.org">SmartOS.org</a>. Allí encontraremos un enlace a la wiki donde está alojada la descarga. En SmartOS no se habla de versiones, hay versiones nuevas cada 2 semanas y se identifican las descargas con las fechas. La descarga está disponible en varios formatos. El formato recomendado es USB, pero para este post vamos a descargar la imagen de VMware. La descarga no es muy grande (~250 MB) y cuando lo tengamos lo descomprimimos en alguna carpeta. Abrimos <a href="https://my.vmware.com/web/vmware/free">VMware Player </a>(o VMware Fusion o VMware Workstation, el que te guste más) y desde allí abrimos la máquina virtual. Nos preguntará que si la hemos movido o copiado. Decimos que la hemos copiado. Ahora tenemos que arrancarla. Antes de nada comprueba que tu ordenador puede ejecutar máquinas virtuales de 64 bits, ya que SmartOS solo es de 64 bits. Una vez lo hemos arrancado nos aparecerá una imagen de GRUB. Seleccionamos la primero opción <strong>Live 64-bit (text)</strong>. Si tienes experiencia instalando sistemas operativos verás que aquí no hay ninguna entrada para instalar. Esto es porque SmartOS no se instala, se configura.<br><h2>Configurando SmartOS</h2><br>Ahora nos saldrá un asistente con una serie de preguntas. Respondemos a ellas. En el tema de la conexión yo elegí DHCP y tenía configurada la máquina virtual para conectarse usando NAT. En el apartado de discos destacar que solo podemos seleccionar el último. Si elegimos el primer disco que se nos ofrece estaremos sobreescribiendo la imagen Live de SmartOS y la suiente vez no arrancará. Cuando hayan terminado las preguntas se reiniciará y en GRUB seleccionamos la misma opción. Ahora veremos un curioso login con el símbolo de Joyent. En este momento el sistema ya está configurado para empezar a trabajar dentro de él. Podemos usar SSH o la terminal del ordenador.<br><h2>Creando la SmartMachine</h2><br>Ahora vamos a crear una SmartMachine. ¿Qué es una SmartMachine? Es una zona dentro de SmartOS autocontenida que no puede interactuar con el exterior. Es una manera de virtualización que ofrece SmartOS (la otra es <a href="http://es.wikipedia.org/wiki/Kernel-based_Virtual_Machine">KVM</a>). En las SmartMachines será el único lugar donde podremos instalar software (realmente sí se puede instalar fuera de una zone con un instalador manual, pero no es recomendable). Bien, ahora debemos actualizar la lista de imágenes base para las SmartMachines.<br><pre class="lang:default decode:true">imgadm update<br></pre><br>Ahora buscamos la que más se adecue a lo que buscamos.<br><pre class="lang:default decode:true">imgadm avail<br></pre><br>En mi caso buscaba algo que tuviese ya Node.js e hice esto.<br><pre class="lang:default decode:true">imgadm avail | grep node<br></pre><br>Y la descargamos con<br><pre class="lang:default decode:true">imgadm import UUID_DE_LA_IMAGEN<br></pre><br>Es importante ver que en SmartOS el uso de los UUID está muy presente como veremos<br><br>Ahora que ya tenemos la base vamos a definir nuestra SmartMachine mejor. Así pues creamos un fichero JSON tal que así. Yo lo he decidido guardar en /tmp/node-zone.json<br><pre class="lang:js decode:true">{<br>"brand" : "joyent",<br>"dataset_uuid": "NUESTRO_UUID",<br>"resolvers" : ["8.8.8.8"],<br>"nics" : [<br>"nic_tag" : "dhcp",<br>"ip" : "dhcp"<br>],<br>"autoboot" : true,<br>"ram" : 512<br>}<br></pre><br>Y en hay muchísimas más opciones. Puedes verlas todas en el manual de vmadm<br><pre class="lang:default decode:true">man vmadm<br></pre><br>Ahora creamos una nueva zone basada en nuestra imagen base con:<br><pre class="lang:default decode:true">vmadm create -f /tmp/node-zone.json<br></pre><br>Ahora podemos encontrar las zonas que estan activas:<br><pre class="lang:default decode:true">zoneadm list -civ<br></pre><br>Como vemos hay dos zonas activas, una es la global, en la que estamos trabajando. La otra es la que acabamos de crear y que tiene un nuevo UUID asignado. Mencionar que las zonas las podemos encender y apagar con vmadm también:<br><pre class="lang:default decode:true">vmadm stop UUID &amp;&amp; vmadm start UUID<br></pre><br>Bien, para entrar a las zonas podemos hacerlo con zlogin<br><pre class="lang:default decode:true">zlogin UUID<br></pre><br>y estaremos dentro de una zona. En mi caso se puede comprobar que ya tengo Node.js instalado con<br><pre class="lang:default decode:true">node -v &amp;&amp; npm -v<br></pre><br><h2>Dentro de la SmartMachine</h2><br>Ahora podemos instalar paquetes para la zona con pkgin. Por ejemplo digamos que quiero instalar <a href="http://cmake.org">CMake</a>.<br><pre class="lang:default decode:true">pkgin update &amp;&amp; pkgin install cmake<br></pre><br>Ahora debemos ajustar todo para la aplicación que deseemos probar. Una buena manera para empezar sería clonar un repositorio Git en la carpeta dentro del usuario de la carpeta /home. Luego instalaríamos todo con<br><pre class="lang:default decode:true">npm install<br></pre><br>Ahora crearemos el servicio. Creamos un fichero XML parecido a este:<br><pre class="lang:default decode:true">&lt;?xml version="1.0"?&gt;<br>&lt;!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1"&gt;<br>&lt;service_bundle type="manifest" name="sonzono"&gt;<br>&lt;service name="site/sonzono" type="service" version="1"&gt;<br><br>&lt;create_default_instance enabled="true"/&gt;<br><br>&lt;single_instance/&gt;<br><br>&lt;dependency name="network" grouping="require_all" restart_on="refresh" type="service"&gt;<br>&lt;service_fmri value="svc:/milestone/network:default"/&gt;<br>&lt;/dependency&gt;<br><br>&lt;dependency name="filesystem" grouping="require_all" restart_on="refresh" type="service"&gt;<br>&lt;service_fmri value="svc:/system/filesystem/local"/&gt;<br>&lt;/dependency&gt;<br><br>&lt;method_context working_directory="/home/admin/sonzono"&gt;<br>&lt;method_credential user="admin" group="staff" privileges='basic,net_privaddr'  /&gt;<br>&lt;method_environment&gt;<br>&lt;envvar name="PATH" value="/home/admin/local/bin:/usr/local/bin:/usr/bin:/usr/sbin:/bin"/&gt;<br>&lt;envvar name="HOME" value="/home/admin"/&gt;<br>&lt;/method_environment&gt;<br>&lt;/method_context&gt;<br><br>&lt;exec_method<br>type="method"<br>name="start"<br>exec="/opt/local/bin/node /home/admin/sonzono/app.js"<br>timeout_seconds="60"/&gt;<br><br>&lt;exec_method<br>type="method"<br>name="stop"<br>exec=":kill"<br>timeout_seconds="60"/&gt;<br><br>&lt;property_group name="startd" type="framework"&gt;<br>&lt;propval name="duration" type="astring" value="child"/&gt;<br>&lt;propval name="ignore_error" type="astring" value="core,signal"/&gt;<br>&lt;/property_group&gt;<br><br>&lt;property_group name="application" type="application"&gt;<br><br>&lt;/property_group&gt;<br><br><br>&lt;stability value="Evolving"/&gt;<br><br>&lt;template&gt;<br>&lt;common_name&gt;<br>&lt;loctext xml:lang="C"&gt;node.js sonzono&lt;/loctext&gt;<br>&lt;/common_name&gt;<br>&lt;/template&gt;<br>&lt;/service&gt;<br>&lt;/service_bundle&gt;<br></pre><br>Lo guardamos dentro de la configuración con.<br><pre class="lang:default decode:true">svccfg import sonzono.xml<br></pre><br>Y ya podemos activar el servicio<br><pre class="lang:default decode:true">svcadm enable sonzono<br></pre><br>Podemos ver los logs de todos los servicios en /var/svc/log/<br><br>Y con esto creo que ya teneis suficiente información acerca de SmartOS como para ir jugueteando con él. Quiero mencionar que SmartOS es un sistema operativo con muy poco soporte pero que poco a poco se va haciendo más importante.<br><h2>Referencias</h2><br><a href="https://github.com/isaacs/joyent-node-on-smart-example">https://github.com/isaacs/joyent-node-on-smart-example</a><br><br><a href="http://docs.instantservers.telefonica.com/display/isc2/Developing+a+Node.js+Application">http://docs.instantservers.telefonica.com/display/isc2/Developing+a+Node.js+Application</a><br><br><a href="http://wiki.smartos.org/display/DOC/How+to+create+a+zone+%28+OS+virtualized+machine+%29+in+SmartOS">http://wiki.smartos.org/display/DOC/How+to+create+a+zone+%28+OS+virtualized+machine+%29+in+SmartOS</a><br><br><a href="http://www.machine-unix.com/beginning-with-smartos/">http://www.machine-unix.com/beginning-with-smartos/</a>