Microsoft sorprendió a todos con la publicación de .NET Core el 27 de junio de 2016. Por primera vez, la plaatforma <a href="http://dot.net">.NET</a> se volvía multiplataforma, con soporte a macOS y GNU/Linux. Y además se volvía software libre, con licencia MIT y con un desarrollo transparente donde cualquiera puede proponer mejoras, subir parches, etc...<br><br>Esto posibilita tener soporte de primer nivel para uno de los lenguajes mejor diseñados actualmente, C#, que hasta entonces tenía un soporte de segunda en Linux, a través de <a href="http://www.mono-project.com/">Mono</a>.<br><br>Inicialmente el soporte de Microsoft a .NET Core abarca: aplicaciones de consola, aplicaciones web ASP.NET y UWP. Mucha gente se desanimó por no tener WinForms o WPF en .NET Core. Sin embargo eso no quiera decir que no se puedan hacer interfaces gráficas en .NET Core. Aquí os presento la librería Avalonia, que aunque está en beta todavía, funciona sorprendentemente bien y en un futuro dará mucho de que hablar.<br><br><a href="https://github.com/AvaloniaUI/Avalonia">Avalonia</a> funciona en Windows, macOS, GNU/Linux, Android e iOS. Usa XAML para las interfaces y su diseño se asemeja a WPF, aunque se han hecho cambios aprovechando características más potentes de C#. Avalonia no es WPF multiplataforma, es mejor.<br><h2>Creando un proyecto</h2><br>En primer lugar, tenemos que instalar .NET Core 2.0. Se descarga en la página oficial. A continuación comprobamos que se ha instalado correctamente con:<br><pre class="lang:default decode:true ">dotnet --version</pre><br>Creamos ahora un nuevo proyecto de tipo consola con <strong>new</strong><br><pre class="lang:default decode:true ">dotnet new console -o GitHubRepos</pre><br>Si todo va bien nos saldrá algo parecido a esto:<br><br><a href="https://files.adrianistan.eu/DotNetNew.png"><img class="aligncenter size-full wp-image-1075" src="https://files.adrianistan.eu/DotNetNew.png" alt="" width="839" height="159" /></a>Se nos habrán generado una carpeta obj y dos archivos: <strong>Program.cs</strong> y <strong>GitHubRepos.csproj</strong>. El primero es el punto de entrada de nuestro programa, el otro es el fichero de proyecto de C#.<br><br>Vamos a probar que todo está en orden compilando el proyecto.<br><pre class="lang:default decode:true">dotnet run</pre><br><h2><a href="https://files.adrianistan.eu/DotNetRun.png"><img class="aligncenter size-full wp-image-1076" src="https://files.adrianistan.eu/DotNetRun.png" alt="" width="461" height="44" /></a>Añadiendo Avalonia</h2><br>Vamos a añadir ahora Avalonia. Instalar dependencias antes en C# era algo complicado. Ahora es muy sencillo, gracias a la integración de <strong>dotnet</strong> con <strong>NuGet</strong>.<br><pre class="lang:default decode:true ">dotnet add package Avalonia<br>dotnet add package Avalonia.Win32<br>dotnet add package Avalonia.Skia.Desktop<br>dotnet add package Avalonia.Gtk3</pre><br><a href="https://files.adrianistan.eu/DotNetAdd.png"><img class="aligncenter size-full wp-image-1077" src="https://files.adrianistan.eu/DotNetAdd.png" alt="" width="842" height="284" /></a>¡Ya no tenemos que hacer nada más! Nuestra aplicación será compatible ya con Windows y GNU/Linux. Para el resto de plataformas, hay más paquetes disponibles en NuGet, sin embargo desconozco su grado de funcionamiento. Solo he probado la librería en Windows 7, Windows 10, Ubuntu y Debian.<br><h2>Program.cs</h2><br>Program.cs define el punto de entrada a la aplicación. Aquí en una aplicación Avalonia podemos dejarlo tan simple como esto:<br><pre class="lang:c# decode:true" title="Program.cs">using System;<br>using Avalonia;<br><br>namespace GitHubRepos<br>{<br>    class Program<br>    {<br>        static void Main(string[] args)<br>        {<br>            AppBuilder<br>                .Configure&lt;App&gt;()<br>                .UsePlatformDetect()<br>                .Start&lt;MainWindow&gt;();<br>        }<br>    }<br>}</pre><br>Básicamente viene a decir que arranque una aplicación Avalonia definida en la clase <strong>App</strong> con la ventana <strong>MainWindow</strong>. A continuación vamos a definir esas clases.<br><h2>App.cs y App.xaml</h2><br>En Avalonia tenemos que definir una clase que represente a la aplicación, normalmente la llamaremos App. Crea un fichero llamado <strong>App.cs</strong> en la misma carpeta de <strong>Program.cs</strong>, con un contenido tan simple como este:<br><pre class="lang:c# decode:true" title="App.cs">using Avalonia;<br>using Avalonia.Markup.Xaml;<br><br>namespace GitHubRepos<br>{<br>    public class App : Application<br>    {<br>        public override void Initialize()<br>        {<br>            AvaloniaXamlLoader.Load(this);<br>        }<br>    }<br>}</pre><br>Lo que hacemos aquí es pedir al intérprete de XAML que lea App.xaml simplemente y por lo demás, es una mera clase hija de <strong>Application</strong>.<br><br>El fichero <strong>App.xaml</strong> contiene definiciones XAML que se aplican a todo el programa, como el estilo visual:<br><pre class="lang:default decode:true " title="App.xaml">&lt;Application xmlns="https://github.com/avaloniaui"&gt;<br>  &lt;Application.Styles&gt;<br>    &lt;StyleInclude Source="resm:Avalonia.Themes.Default.DefaultTheme.xaml?assembly=Avalonia.Themes.Default"/&gt;<br>    &lt;StyleInclude Source="resm:Avalonia.Themes.Default.Accents.BaseLight.xaml?assembly=Avalonia.Themes.Default"/&gt;<br>  &lt;/Application.Styles&gt;<br>&lt;/Application&gt;</pre><br><h2>MainWindow.cs y MainWindow.xaml</h2><br>Ahora nos toca definir una clase para la ventana principal de la aplicación. El código para empezar es extremadamente simple también:<br><pre class="lang:c# decode:true " title="MainWindow.cs">using Avalonia;<br>using Avalonia.Controls;<br>using Avalonia.Markup.Xaml;<br><br>namespace GitHubRepos<br>{<br>    public class MainWindow : Window<br>    {<br>        public MainWindow()<br>        {<br>            Initialize();<br>        }<br>        private void Initialize()<br>        {<br>            AvaloniaXamlLoader.Load(this);<br>        }<br>    }<br>}</pre><br>Aquí hacemos lo mismo que con App.cs, mandamos cargar el fichero XAML. Este fichero XAML contiene los widgets que va a llevar la ventana. Parecido a HTML, <a href="https://es.wikipedia.org/wiki/QML">QML</a> de Qt, <a href="https://glade.gnome.org/">Glade</a> de GTK o <a href="https://en.wikipedia.org/wiki/FXML">FXML</a> de Java o <a href="https://es.wikipedia.org/wiki/XML-based_User-interface_Language">XUL</a> de Mozilla.<br><pre class="lang:default decode:true" title="MainWindow.xaml">&lt;Window xmlns="https://github.com/avaloniaui"<br>        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"<br>        Title="GitHub Repositories"&gt;<br>        &lt;StackPanel HorizontalAlignment="Center"&gt;<br>                &lt;Button Content="¡Hola mundo!"&gt;&lt;/Button&gt;<br>        &lt;/StackPanel&gt;<br>&lt;/Window&gt;</pre><br><h2>GitHubRepos.csproj</h2><br>Antes de poder compilar es necesario modificar el fichero de proyecto para incluir los ficheros XAML en el binario. Se trata de añadir un nuevo <strong>ItemGroup</strong> y dentro de él un <strong>EmbeddedResource</strong>.<br><pre class="lang:c# decode:true " title="GitHubRepos.csproj">&lt;Project Sdk="Microsoft.NET.Sdk"&gt;<br>  &lt;PropertyGroup&gt;<br>    &lt;OutputType&gt;Exe&lt;/OutputType&gt;<br>    &lt;TargetFramework&gt;netcoreapp2.0&lt;/TargetFramework&gt;<br>  &lt;/PropertyGroup&gt;<br>  &lt;ItemGroup&gt;<br>    &lt;PackageReference Include="Avalonia" Version="0.5.1" /&gt;<br>    &lt;PackageReference Include="Avalonia.Skia.Desktop" Version="0.5.1" /&gt;<br>    &lt;PackageReference Include="Avalonia.Win32" Version="0.5.1" /&gt;<br>  &lt;/ItemGroup&gt;<br>  &lt;!-- HE AÑADIDO ESTO --&gt;<br>  &lt;ItemGroup&gt;<br>    &lt;EmbeddedResource Include="**\*.xaml"&gt;<br>      &lt;SubType&gt;Designer&lt;/SubType&gt;<br>    &lt;/EmbeddedResource&gt;<br>  &lt;/ItemGroup&gt;<br>  &lt;!-- HASTA AQUÍ --&gt;<br>&lt;/Project&gt;</pre><br>Ahora ya podemos compilar con <strong>dotnet run</strong>.<br><br>Nos deberá salir algo como esto:<br><h2><a href="https://files.adrianistan.eu/Captura-de-pantalla-26.png"><img class="aligncenter size-large wp-image-1078" src="https://files.adrianistan.eu/Captura-de-pantalla-26-1024x576.png" alt="" width="840" height="473" /></a>Añadiendo clicks</h2><br>Vamos a darle vidilla a la aplicación añadiendo eventos. Para ello primero hay que darle un nombre al botón, un ID. Usamos <strong>Name</strong> en XAML. También usaremos un <strong>TextBlock</strong> para representar texto.<br><pre class="lang:c# decode:true" title="MainWindow.xaml">&lt;Window xmlns="https://github.com/avaloniaui"<br>        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"<br>        Title="GitHub Repositories"&gt;<br>        &lt;StackPanel HorizontalAlignment="Center"&gt;<br>                &lt;Button Name="lanzar" Content="Lanzar dado"&gt;&lt;/Button&gt;<br>                &lt;TextBlock Name="resultado"&gt;No has lanzado el dado todavía&lt;/TextBlock&gt;<br>        &lt;/StackPanel&gt;<br>&lt;/Window&gt;</pre><br>Ahora en <strong>MainWindow.cs</strong>, en el constructor, podemos obtener referencia a los objetos XAML con <strong>Find</strong>.<br><pre class="lang:c# decode:true " title="MainWindow.cs">using Avalonia;<br>using Avalonia.Controls;<br>using Avalonia.Interactivity;<br>using Avalonia.Markup.Xaml;<br>using System;<br><br>namespace GitHubRepos<br>{<br>    public class MainWindow : Window<br>    {<br>        Button lanzar;<br>        TextBlock resultado;<br>        public MainWindow()<br>        {<br>            Initialize();<br><br>            lanzar = this.Find&lt;Button&gt;("lanzar");<br>            lanzar.Click += LanzarDado;<br><br>            resultado = this.Find&lt;TextBlock&gt;("resultado");<br>        }<br>        private void Initialize()<br>        {<br>            AvaloniaXamlLoader.Load(this);<br>        }<br><br>        private void LanzarDado(object sender, RoutedEventArgs e)<br>        {<br>            var r = new Random().Next(0,6) + 1;<br>            resultado.Text = $"Dado: {r}";   <br>        }<br>    }<br>}</pre><br>Y ya estaría. También comentar que la función <strong>LanzarDado</strong> puede ser <strong>async</strong> si nos conviene. A partir de ahora ya puedes sumergirte en el código de Avalonia (¡porque documentación todavía no hay!) y experimentar por tu cuenta.<br><h2><a href="https://files.adrianistan.eu/Captura-de-pantalla-27.png"><img class="aligncenter size-large wp-image-1079" src="https://files.adrianistan.eu/Captura-de-pantalla-27-1024x576.png" alt="" width="840" height="473" /></a>Un ejemplo real, GitHubRepos</h2><br>Ahora os voy a enseñar un ejemplo real de la comodidad que supone usar Avalononia con .NET Core. He aquí un pequeño programa que obtiene la lista de repositorios de un usuario y los muestra por pantalla.<br><pre class="lang:c# decode:true " title="MainWindow.cs">using Avalonia;<br>using Avalonia.Controls;<br>using Avalonia.Interactivity;<br>using Avalonia.Markup.Xaml;<br>using System;<br>using System.Net.Http;<br>using System.Net.Http.Headers;<br>using System.Collections.Generic;<br>using System.Runtime.Serialization.Json;<br>using System.Linq;<br><br>namespace GitHubRepos<br>{<br>    public class MainWindow : Window<br>    {<br>        Button refresh;<br>        TextBox username;<br>        TextBlock status;<br>        ListBox repos;<br>        public MainWindow()<br>        {<br>            Initialize();<br><br>            refresh = this.Find&lt;Button&gt;("refresh");<br>            refresh.Click += RefreshList;<br><br>            username = this.Find&lt;TextBox&gt;("username");<br>            status = this.Find&lt;TextBlock&gt;("status");<br>            repos = this.Find&lt;ListBox&gt;("repos");<br>        }<br>        private void Initialize()<br>        {<br>            AvaloniaXamlLoader.Load(this);<br>        }<br><br>        private async void RefreshList(object sender, RoutedEventArgs e)<br>        {<br>            var user = username.Text;<br>            status.Text = $"Obteniendo repositorios de {user}";<br>            var client = new HttpClient();<br>            client.DefaultRequestHeaders.Accept.Clear();<br>            client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/vnd.github.v3+json"));<br>            client.DefaultRequestHeaders.Add("User-Agent", "GitHubRepos - Avalonia");<br>            try{<br>                var downloadTask = client.GetStreamAsync($"https://api.github.com/users/{user}/repos");<br><br>                var serializer = new DataContractJsonSerializer(typeof(List&lt;GitHubRepo&gt;));<br>                var repoList = serializer.ReadObject(await downloadTask) as List&lt;GitHubRepo&gt;;<br><br>                repos.Items = repoList.OrderByDescending(t =&gt; t.Stars).Select(repo =&gt; {<br>                    var item = new ListBoxItem();<br>                    item.Content=$"{repo.Name} - {repo.Language} - {repo.Stars}";<br>                    return item;<br>                });<br>                status.Text = $"Repositorios de {user} cargados";<br>            }catch(HttpRequestException){<br>                status.Text = "Hubo un error en la petición HTTP";<br>            }catch(System.Runtime.Serialization.SerializationException){<br>                status.Text = "El fichero JSON es incorrecto";<br>            }<br>        }<br>    }<br>}</pre><br>Y este es su correspondiente XAML:<br><pre class="lang:default decode:true" title="MainWindow.xaml">&lt;Window xmlns="https://github.com/avaloniaui"<br>        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"<br>        Title="GitHub Repositories"<br>        Width="300"<br>        Height="500"&gt;<br>        &lt;Grid&gt;<br>                &lt;Grid.RowDefinitions&gt;<br>                        &lt;RowDefinition Height="50"/&gt;<br>                        &lt;RowDefinition /&gt;<br>                &lt;/Grid.RowDefinitions&gt;<br>        <br>                &lt;StackPanel Grid.Row="0" HorizontalAlignment="Center"&gt;<br>                        &lt;StackPanel Orientation="Horizontal"&gt;<br>                                &lt;TextBox Name="username"&gt;aarroyoc&lt;/TextBox&gt;<br>                                &lt;Button Name="refresh" Content="Actualizar"&gt;&lt;/Button&gt;<br>                        &lt;/StackPanel&gt;<br>                        &lt;TextBlock Name="status"&gt;&lt;/TextBlock&gt;<br>                &lt;/StackPanel&gt;<br>                &lt;ListBox Grid.Row="1" ScrollViewer.VerticalScrollBarVisibility="Visible" SelectionMode="Single" Name="repos"&gt;&lt;/ListBox&gt;<br>        &lt;/Grid&gt;<br>&lt;/Window&gt;</pre><br>Adicionalmente, he usado una clase extra para serializar el JSON.<br><pre class="lang:c# decode:true " title="GitHubRepo.cs">using System.Runtime.Serialization;<br><br>namespace GitHubRepos{<br>    [DataContract(Name="repo")]<br>    public class GitHubRepo{<br><br>        [DataMember(Name="name")]<br>        public string Name;<br><br>        [DataMember(Name="language")]<br>        public string Language;<br>        [DataMember(Name="stargazers_count")]<br>        public int Stars;<br>    }<br>}</pre><br>El resultado es bastante satisfactorio:<br><br><a href="https://files.adrianistan.eu/GitHubRepos.png"><img class="aligncenter size-full wp-image-1080" src="https://files.adrianistan.eu/GitHubRepos.png" alt="" width="310" height="546" /></a><br><br>&nbsp;