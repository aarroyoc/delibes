En el <a href="https://blog.adrianistan.eu/2018/09/19/ipfs-el-futuro-de-la-web-descentralizada/">primer post</a> vimos como interactuar con IPFS de forma sencilla. Ahora vamos a dar un paso más y vamos a alojar una web en IPFS, aprovechando todas las ventajas de escalabilidad y disponibilidad que nos ofrece la red. Para ello usaremos además otro protocolo llamado IPNS, que sería similar a DNS pero en la red IPFS.<br><br>Las páginas ideales para IPFS actualmente son las que siguen el <a href="https://jamstack.org/">JAMstack</a>, es decir, uso extensivo de JavaScript en el cliente, que podrá conectarse a APIs para obtener/actualizar información. Las APIs no tienen por qué ser centralizadas, ya que JavaScript con WebRTC puede buscar peers, posibilitando APIs descentralizadas.<br><h2>Generando el contenido estático</h2><br>El primer paso será generar el contenido estático de la web. Para ello existen herramientas muy conocidas como <a href="https://blog.adrianistan.eu/2014/08/05/probando-jekyll/">Jekyll</a>, <a href="https://blog.adrianistan.eu/2016/05/26/tutorial-hugo-espanol-generador-sitios-estaticos/">Hugo</a> o <a href="https://blog.getpelican.com/">Pelican</a>.<br><br>No nos vamos a alargar más en esto, ya que cada herramienta tiene sus pasos. El resultado final será una carpeta con ficheros HTML, CSS, fuentes, imágenes y JavaScript.<br><h2>Subir a IPFS</h2><br>Teniendo el nodo IPFS en funcionamiento, subimos la carpeta del modo habitual, en mi caso, voy a subir la página que está en <a href="http://adrianistan.eu">http://adrianistan.eu</a> .<br><pre class="lang:default decode:true ">ipfs add -r adrianistan.eu/</pre><br><a href="https://files.adrianistan.eu/IPFS-AddWebsite.png"><img class="aligncenter size-large wp-image-1597" src="https://files.adrianistan.eu/IPFS-AddWebsite-1024x195.png" alt="" width="840" height="160" /></a>Y anotamos el último hash.<br><br>Comprobamos que la web es accesible, tanto desde la gateway del nodo, como una externa:<br><br><a href="https://files.adrianistan.eu/IPFS-CheckGateway.png"><img class="wp-image-1599 size-large" src="https://files.adrianistan.eu/IPFS-CheckGateway-1024x508.png" alt="" width="840" height="417" /></a> Tanto en el nodo local como en uno externo, la web carga perfectamente con el hash<br><h2><a href="https://files.adrianistan.eu/IPFS-GatewayExternal.png"><img class="aligncenter size-large wp-image-1598" src="https://files.adrianistan.eu/IPFS-GatewayExternal-1024x508.png" alt="" width="840" height="417" /></a> IPFS tiene direccionamiento por contenido</h2><br>En el post anterior mencionamos que IPFS direcciona por contenido gracias a los hashes. Esto tiene unas consecuencias interesantes. Por ejemplo, si se añade un archivo duplicado a IPFS, este tiene exactamente la misma dirección, ya que comparten hash. Por otro lado, los documentos no se pueden actualizar, porque entonces su hash cambia. Sin embargo en una web queremos cambiar contenido, ahí entra en acción IPNS.<br><h2>IPNS, gestión de nombres para IPFS</h2><br>IPNS es un protocolo parecido en intenciones a DNS que redirige un ID única al hash correspondiente en ese momento. Registramos el hash de la web actual en IPNS.<br><pre class="lang:default decode:true ">ipfs name publish HASH</pre><br><a href="https://files.adrianistan.eu/IPNS.png"><img class="aligncenter size-large wp-image-1600" src="https://files.adrianistan.eu/IPNS-1024x58.png" alt="" width="840" height="48" /></a>Ahora sí, el hash IPNS puede publicarse por la red, ya que siempre apuntará a la última versión de la web.<br><br>Para acceder a recursos a través de IPNS tenemos que cambiar de protocolo, en vez de /ipfs/HASH, tenemos que poner <strong>/ipns/HASH</strong>. Vale tanto para comandos como para las gateways HTTP.<br><br><a href="https://cloudflare-ipfs.com/ipns/QmYDVeoadAzk9ZW6zwJK3E3KHrA1LWLveEdqUv4XAcCjKa/">https://cloudflare-ipfs.com/ipns/QmYDVeoadAzk9ZW6zwJK3E3KHrA1LWLveEdqUv4XAcCjKa/</a><br><br>En cualquier momento podemos comprobar a que dirección IPFS apunta el hash IPNS:<br><pre class="lang:default decode:true ">ipfs name resolve QmYDVeoadAzk9ZW6zwJK3E3KHrA1LWLveEdqUv4XAcCjKa</pre><br><a href="https://files.adrianistan.eu/IPNS-Resolve.png"><img class="aligncenter size-full wp-image-1601" src="https://files.adrianistan.eu/IPNS-Resolve.png" alt="" width="837" height="62" /></a>Para actualizar el contenido simplemente se vuelve a repetir el paso de <em>ipfs name publish</em>. IPFS automáticamente modificará la redirección de IPNS.<br><br>Los contenidos antiguos no desaparecen, pero pueden no ser accesibles ya que ningún nodo tenga copia de ellos.<br><h2>DNSLink</h2><br>Aún así, ir dándole a la gente un hash IPNS es demasiado complicado. Afortunadamente, podemos usar el DNS tradicional para indicar una ruta IPNS y así, como veremos, facilitar bastante las cosas.<br><br>Para ello añadimos un campo TXT en los DNS de nuestro dominio. El contenido es el siguiente:<br><pre class="lang:default decode:true ">dnslink=/ipns/HASH</pre><br>Con esto podremos usar <strong>/ipns/dominio.com</strong> en la red IPFS. Pero todavía hace falta un cliente IPFS.<br><br>Afortunadamente, podemos redirigir mediante CNAME a una gateway HTTP de confianza y ¡la web funcionará correctamente! Para ello hay que crear un campo TXT en el subdominio <strong>_dnslink </strong>con el mismo contenido que el anterior.<br><br>Todas las gateways de IPFS soportan DNSLink para que la transición a IPFS sea lo más transparente posible.<br><br><a href="https://files.adrianistan.eu/DNSLink.png"><img class="aligncenter size-full wp-image-1602" src="https://files.adrianistan.eu/DNSLink.png" alt="" width="778" height="166" /></a>Así, finalmente la página carga con un dominio normal y corriente en un navegador normal y corriente.<br><br><a href="https://files.adrianistan.eu/IPNS-DNSLink.png"><img class="size-large wp-image-1603" src="https://files.adrianistan.eu/IPNS-DNSLink-1024x507.png" alt="" width="840" height="416" /></a> Fijaos en la URL<br><br>De hecho, vosotros mismos podéis acceder:<br><br><a href="http://adrianistan.yayeyo.ga">http://adrianistan.yayeyo.ga</a><br><h2>IPFS Companion</h2><br>Si usamos mucho IPFS, puede que nos interese una extensión que maneje el protocolo <strong>ipfs://</strong> . Tanto en <a href="https://addons.mozilla.org/en-US/firefox/addon/ipfs-companion/">Firefox</a> como en <a href="https://chrome.google.com/webstore/detail/ipfs-companion/nibjojkomfdiaoajekhjakgkdhaomnch">Chrome</a> existe IPFS Companion, una extensión que nos permite acceder a contenido IPFS de forma sencilla.<br><h2><a href="https://files.adrianistan.eu/IPFS-Companion.png"><img class="aligncenter size-large wp-image-1604" src="https://files.adrianistan.eu/IPFS-Companion-1024x640.png" alt="" width="840" height="525" /></a>Servicio systemd</h2><br>Por último, quiero dejar el servicio de systemd necesario para tener el nodo IPFS funcionando constantemente en nuestro ordenador. En este caso, IPFS lo instalé vía Snap.<br><pre class="lang:default decode:true ">[Unit]<br>Description=IPFS daemon<br><br>[Service]<br>ExecStart=/snap/bin/ipfs daemon<br>Restart=on-failure<br><br>[Install]<br>WantedBy=default.target</pre><br><pre class="lang:default decode:true ">sudo cp ipfs.service /etc/systemd/user/</pre><br><pre class="lang:default decode:true ">sudo systemctl --user start ipfs.service<br>sudo systemctl --user enable ipfs.service</pre><br>Y con esto ya tendríamos suficiente como para jugar con IPFS un buen rato.