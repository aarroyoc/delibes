HTML5 ha llegado aquí y está para quedarse y puede usarse en prácticamente cualquier sitio. Además según la <a href="https://blog.adrianistan.eu/2016/01/08/bienvenido-2016-bienvenido-kaizen/">encuesta del blog</a> HTML5 era uno de los temas en los que estabais más interesados. Hoy vamos a ver como se puede hacer un mapa interactivo fácilmente, compatible con PCs, tabletas y móviles y veremos como los podemos animar.<br><br><iframe src="https://jsfiddle.net/aarroyoc/wyvjeoef/1/embedded/result,js,html/" width="100%" height="300" frameborder="0" allowfullscreen="allowfullscreen"></iframe><br><blockquote><em>Haz click en la provincia de Valladolid múltiples veces</em></blockquote><br><h2 id="snapsvg">SnapSVG</h2><br>Aquí entra en juego <a href="http://snapsvg.io">SnapSVG</a>. Se trata de una librería para JavaScript financiada y acogida por Adobe. Es una mejora de la ya popular librería para tratar SVG conocida como RaphaëlJS (ambas librerías son del mismo autor). Sin embargo, SnapSVG aporta muchas mejoras respecto a RaphaëlJS. La fundamental es que SnapSVG permite cargar archivos SVG ya existentes.<br><br><img class="alignnone size-large wp-image-105" src="https://files.adrianistan.eu/snapsvg-1024x343.png" alt="snapsvg" width="840" height="281" /><br><h2 id="mapasensvg">Mapas en SVG</h2><br>Actualmente es fácil encontrar mapas en SVG de cualquier territorio. Sin embargo para que sea fácil trabajar con ellos hay que procurar que estén preparados para interactuar con ellos. Es necesario que las etiquetas <code>&lt;path&gt;</code> posean un atributo <code>id</code> y sea fácilmente reconocible. En el caso del mapa de España que hay al principio, el mapa está muy bien organizado. Las provincias empiezan por pr, los enclaves por en y las islas por is. Así que Valladolid es <code>pr_valladolid</code> y Menorca es <code>is_menorca</code>. Encontrar mapas así ya puede ser más difícil pero no imposible.<br><h2 id="primerospasos">Primeros pasos</h2><br>En nuestro HTML creamos una etiqueta <code>&lt;svg&gt;</code> con un <code>id</code>, por ejemplo <code>id=papel</code>. Ya está. Ahora pasamos al JavaScript.<br><br>Primero necesitamos obtener un papel (Paper en la documentación), con la función Snap y un selector CSS obtenemos el papel que ya hemos creado.<br><br><pre class="lang:js decode:true"><br>var s = Snap(&quot;#papel&quot;);<br></pre><br><br>Ahora ya podemos usar todo el poder de SnapSVG, pero si queremos trabajar con un SVG ya existente el procedimiento es un poco distinto.<br><br><pre class="lang:js decode:true"><br>var s = Snap(&quot;#papel&quot;); // Obtenemos el papel<br>Snap.load(&quot;/mapa.svg&quot;,function(f){<br>	// Al cargar el mapa se nos devuelve un fragmento<br>    // los fragmentos contienen elementos de SVG<br>    // Como queremos añadir todos los elementos, los seleccionamos todos, como un único grupo<br>    // otra vez vemos los selectores CSS en acción<br>    var g = f.selectAll(&quot;*&quot;);<br>    // y ahora añadimos el grupo al papel<br>    s.append(g);<br>    <br>    // cuando querramos acceder a un elemento podemos usar un selector CSS<br>    var valladolid = s.select(&quot;#pr_valladolid&quot;);<br>});<br></pre><br><h2 id="atributos">Atributos</h2><br>Podemos alterar los atributos de estilo de SVG. Para quién no los conozca, funcionan igual que las propiedades CSS pero se aplican de manera distinta. Con SnapSVG podemos cambiar esos atributos en tiempo de ejecución. Por ejemplo, el relleno (propiedad <code>fill</code>).<br><br><pre class="lang:js decode:true"><br>s.attr({<br>	fill: &quot;red&quot;<br>});<br>// Cambia el relleno a rojo, afecta a los elementos inferiores, en este caso como es el papel, afecta a todo el SVG.<br></pre><br><h2 id="figurassimples">Figuras simples</h2><br>Podemos añadir figuras simples de manera muy sencilla<br><br><pre class="lang:js decode:true"><br>var rect = s.rect(0,0,100,20).attr({fill: &quot;cyan&quot;});<br>// Creamos un rectángulo de 100x20 en la posición (0,0) con relleno cyan.<br>// Luego lo podemos borrar<br>rect.remove();<br></pre><br><h2 id="eventosyanimaciones">Eventos y animaciones</h2><br>Ahora viene la parte interesante, eventos y animaciones. SnapSVG soporta varios tipos de evento en cada elemento. Veamos el click simple aunque existe doble click, ratón por encima, táctil (aunque click funciona en pantallas táctiles).<br><br><pre class="lang:js decode:true"><br>var murcia = s.select(&quot;#pr_murcia&quot;);<br>murcia.click(function(){<br>	murcia.attr({<br>    	fill: &quot;yellow&quot;<br>    });<br>});<br></pre><br><br><br>Podemos animar los elementos especificando las propiedades que cambian y su tiempo<br><br><pre class="lang:js decode:true"><br>murcia.animate({fill: &quot;purple&quot;},1000);<br></pre><br><br>SnapSVG es muy potente y permite realizar muchas más operaciones, como elementos arrastrables, grupos, patrones, filtros y más. El objetivo, según Adobe, es ser el jQuery de los documentos SVG.<br><br><img class="alignnone size-full wp-image-106" src="https://files.adrianistan.eu/snapsvg-game.png" alt="snapsvg-game" width="841" height="752" /><br><h2 id="escalarimagenautomticamente">Escalar imagen automáticamente</h2><br><img class="alignnone size-full wp-image-128" src="https://files.adrianistan.eu/viewBox.png" alt="viewBox" width="600" height="480" /><br><br>SVG es un formato vectorial así que podemos aumentar el tamaño sin tener que preocuparnos por los píxeles. Sin embargo si simplemente cambias el tamaño del elemento <code>&lt;svg&gt;</code> vía CSS verás que no funciona. Es necesario especificar un atributo <code>viewBox</code> y mantenerlo constante. Básicamente viewBox da las dimensiones reales del lienzo donde se dibuja el SVG. Si cambian <code>width</code> y <code>height</code> y <code>viewBox</code> también entonces la imagen no se escala, simplemente se amplía el área del lienzo. Algunos mapas en SVG no ofrecen viewBox. En ese caso espeficicamos como viewBox el tamaño original del fichero SVG. En el caso de querer ocupar toda la pantalla.<br><br><pre class="lang:js decode:true"><br>s.attr({ viewBox: &quot;0 0 800 600&quot;,width: window.innerWidth, height: window.innerHeight});<br>window.addEventListener(&quot;resize&quot;,function(){<br>	s.attr({ viewBox: &quot;0 0 800 600&quot;,width: window.innerWidth, height: window.innerHeight});<br>});<br></pre><br><h2 id="cordovayandroid">Cordova y Android</h2><br>SnapSVG se puede usar en <a href="http://cordova.apache.org">Apache Cordova</a>. Sin embargo yo he tenido problemas de rendimiento con la configuración por defecto en Android. Para solventar este problema he tenido que:<br><ul><br> 	<li><a href="https://crosswalk-project.org/documentation/cordova.html">Instalar el plugin Crosswalk de Android WebView</a></li><br> 	<li>Desactivar la aceleración por hardware en la aplicación.<br><ul><br> 	<li>En el AndroidManifest.xml poner <code>android:hardwareAccelerated="false"</code></li><br></ul><br></li><br></ul><br>Solo así conseguí un rendimiento decente dentro de Cordova.