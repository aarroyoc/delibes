La computación ha avanzado. Ha aumentado la potencia de cálculo. Y no lo ha hecho subiendo la velocidad del reloj del procesador, pues no queremos tener minitostadoras. En vez de eso se ha escogido el camino de <em>paralelizar</em>. Todo lo que sea susceptible de ser paralelizado deberá ser paralelizado. Desafortunadamente la programación en paralelo es compleja y requiere una planificación mucho más larga. ¡Pero no desistamos! ¡Podemos usar GNU Parallel para paralelizar algunas tareas que llevan tiempo pero son independientes las unas de las otras! <strong>¡Usemos <a href="http://www.gnu.org/software/parallel/">GNU Parallel</a> en nuestros scripts!</strong><br><br><img class="alignnone size-large wp-image-43" src="https://files.adrianistan.eu/GNUParallel-1024x576.png" alt="GNUParallel" width="840" height="473" /><br><br>Ejemplos prácticos:<br>- Convertir una biblioteca de MP3 en OGG (con ffmpeg)<br>- Normalizar el audio (con sox)<br>- Optimizar las imágenes de un sitio web (con OptiPNG, jpegoptim, etc)<br><h2 id="instalargnuparallel">Instalar GNU Parallel</h2><br>En Debian/Ubuntu:<br><pre><code>sudo apt install parallel<br></code></pre><br>En Fedora:<br><pre><code>dnf install parallel<br></code></pre><br>En openSUSE:<br><pre><code>zypper install gnu_parallel<br></code></pre><br>En Arch Linux:<br><pre><code>pacman -S parallel<br></code></pre><br>En NetBSD/SmartOS:<br><pre><code>pkgin install parallel<br></code></pre><br><h2 id="convertirunabibliotecademp3enoggynormalizarelaudio">Convertir una biblioteca de MP3 en OGG y normalizar el audio</h2><br>Esta era la tarea que tenía que realizar. Primero realicé una versión sencilla, que funcionaba utilizando un solo core del procesador.<br><br><pre class="lang:default decode:true"><br>#!/bin/bash<br>shopt -s globstar<br>for i in **/*.mp3; do<br>	BASENAME=&quot;${i%.mp3}&quot;<br>	ffmpeg -i &quot;${BASENAME}.mp3&quot; &quot;${BASENAME}.tmp.ogg&quot;<br>	sox --show-progress --norm &quot;${BASENAME}.tmp.ogg&quot; &quot;${BASENAME}.ogg&quot;<br>	rm &quot;${BASENAME}.tmp.ogg&quot;<br>done<br></pre><br><br>Con este script conseguimos el objetivo que nos habíamos propuesto, pero podemos optimizar el rendimiento. Usando GNU Parallel:<br><br><pre class="lang:default decode:true"><br>#!/bin/bash<br><br># Guardar como &quot;normalize.sh&quot;<br><br>if [ &quot;$2&quot; = &quot;1&quot;  ]; then<br>	BASENAME=&quot;${1%.mp3}&quot;<br>	ffmpeg -i &quot;${BASENAME}.mp3&quot; &quot;${BASENAME}.tmp.ogg&quot;<br>	sox --show-progress --norm &quot;${BASENAME}.tmp.ogg&quot; &quot;${BASENAME}.ogg&quot;<br>	rm &quot;${BASENAME}.tmp.ogg&quot;<br>else<br>	find  . -name &quot;*.mp3&quot; | parallel ./normalize.sh &quot;{}&quot; 1<br>fi<br></pre><br><br>Con esta modificación GNU Parallel se encarga de poner en cola los trabajos de conversión y normalización y los reparte entre los cores disponibles del procesador. La gráfica explica claramente la diferencia de uso entre los dos scripts.<br><h6 id="versinbsica">Versión básica</h6><br><img class="alignnone size-large wp-image-123" src="https://files.adrianistan.eu/TradicionalCore-1024x576.png" alt="TradicionalCore" width="840" height="473" /><br><h6 id="versingnuparallel">Versión GNU Parallel</h6><br><img class="alignnone size-large wp-image-43" src="https://files.adrianistan.eu/GNUParallel-1024x576.png" alt="GNUParallel" width="840" height="473" /><br><h2 id="optimizarlasimgenesdeunsitioweb">Optimizar las imágenes de un sitio web</h2><br>Aquí viene otro ejemplo que usa GNU Parallel para realizar la tarea más rápidamente.<br><br><pre class="lang:default decode:true"><br>#!/bin/bash<br><br># Guardar como &quot;optimize-img.sh&quot;<br><br>if [ &quot;$2&quot; = &quot;1&quot;  ]; then<br>	BASENAME=&quot;${1%.png}&quot;<br>	optipng -o7 &quot;${BASENAME}.png&quot;<br>elif [ &quot;$2&quot; = &quot;2&quot;  ]; then<br>	BASENAME=&quot;${1%.jpg}&quot;<br>	jpegoptim &quot;${BASENAME}.jpg&quot;<br>else<br>	find  . -name &quot;*.png&quot; | parallel ./optimize-img.sh &quot;{}&quot; 1<br>	find  . -name &quot;*.jpg&quot; | parallel ./optimize-img.sh &quot;{}&quot; 2<br>fi<br></pre><br>Hay muchos más usos para GNU Parallel, solo tienes que usar tu imaginación. ¿Y tú? ¿Conocías GNU Parallel? ¿Qué opinas al respecto?