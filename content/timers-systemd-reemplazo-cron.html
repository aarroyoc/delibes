Odiado por muchos, alabado por otros, <strong>systemd</strong> se ha impuesto como el init por excelencia del mundo Linux. Las distros más populares como Debian, Ubuntu, Fedora, openSUSE y Arch Linux usan systemd por defecto. Hoy vengo a hablaros de una característica interesante de <strong>systemd</strong> que son son los timers. Se trata de poder definir que arranquen programas/servicios cada cierto tiempo o a una hora, su versatilidad es tal que pueden sustituir a <strong>cron</strong> en la mayoría de casos. Veamos como usar los timers.<br><h2>Creando un servicio</h2><br>Para crear un timer primero necesitamos crear un servicio simple que ejecute el comando que queramos al ser iniciado.<br><br>Crea el archivo <em>miapp.service<strong> </strong></em>y ponlo en <em>/etc/systemd/system/</em>.<br><br><pre class="lang:default decode:true"><br>[Unit]<br>Description=Cat Mania GIF<br><br>[Service]<br>ExecStart=/home/pi/charlatan/catmania.py<br></pre><br><br>&nbsp;<br><h2>Creando el timer</h2><br>Para el timer es necesario un archivo con extensión <strong>timer</strong> en <em>/etc/systemd/system/</em>. Se suele usar el mismo nombre que el que tiene el servicio para escenarios simples. El archivo <em>miapp.timer</em> quedaría así:<br><br><pre class="lang:default decode:true"><br>[Unit]<br>Description=Run Cat Mania daily<br><br>[Timer]<br>OnCalendar=daily<br>RandomizedDelaySec=5min<br>Unit=catmania.service<br><br>[Install]<br>WantedBy=timers.target<br></pre><br><br>&nbsp;<br><br>Aquí es donde podemos realizar toda la magia de los timers. Los timers de systemd tienen dos modos de funcionamiento. En el primer modo, systemd ejecutará el timer cada cierto tiempo desde el arranque del sistema ( o algo más tarde si no queremos saturar el sistema). El otro modo es el modo <strong>calendario</strong> donde podemos especificar fechas y horas con wildcards y patrones. Además, es posible modificar la hora exacta de ejecución del timer con las propiedades de <em>Randomize</em> y que evitan que si hay varios timers configurados a la vez, no lo hagan exactamente a la vez (pero siempre dentro de un margen). Otras opciones para OnCalendar pueden ser:<br><pre class="lang:default decode:true"><br>OnCalendar=Wed,Sun *-*-10..15 12:00:00<br></pre><br><br>En ese caso, el timer se activaría los miércoles y domingos que cayesen entre el 10 y el 15 de todos los meses a las 12 horas.<br><br><h2>Activando el timer</h2><br>Una vez estén copiados los archivos service y timer ejecutamos:<br><br><pre class="lang:default decode:true"><br>systemctl start miapp.timer<br>systemctl enable miapp.timer<br></pre><br><br>Ya solo queda esperar a que systemd lance el servicio en la fecha y hora especificados.<br><h2>Monitorización</h2><br>Los timers están integrados con systemd, por lo que los logs se registran con <strong>journalctl</strong>. Podemos inspeccionarlos de forma sencilla:<br><br><pre class="lang:default decode:true"><br>journalctl -f -u miapp.service<br>journalctl -f -u miapp.timer<br></pre><br><br>Para revisar los timers instalados y activos en el sistema puedes usar el comando:<br><br><pre class="lang:default decode:true"><br>systemtctl list-timers<br></pre><br><br>Y ya estaría. De este modo podemos usar systemd como reemplazo de cron. Yo personalmente lo prefiero, ya que me parece una sintaxis más clara.