Hoy vamos a crear nuestro propio paquete para Haiku. Se trata de mi juego SuperFreeCell que diseñé para el Google Code-In 2014.<br><br><img class="alignnone size-large wp-image-108" src="https://files.adrianistan.eu/SuperFreeCell-1-1024x768.png" alt="SuperFreeCell-1" width="840" height="630" /><br><h2>Nuestra propia rama de desarrollo</h2><br>Si queremos publicar nuestros cambios a Haikuports, debemos hacernos una cuenta en BitBucket y hacer un fork del repositorio. Esto se hace desde <a href="http://github.com/haikuports/haikuports">http://github.com/haikuports/haikuports</a> y dándole al botón de fork o dividir. En mi caso creé el repositorio https://bitbucket.org/AdrianArroyoCalle/haikuports-superfreecell. Añadimos el repositorio a nuestra lista de orígenes en Git.<br><br><br><pre class="lang:default decode:true"><br><br>git remote add superfreecell https://bitbucket.org/AdrianArroyoCalle/haikuports-superfreecell<br><br></pre><br><br><h2>Ubicando el juego en Haikuports</h2><br>Nada más empezar tenemos que encontrar la categoría a la que pertenecerá el paquete. Cada carpeta dentro de la carpeta haikuports representa una categoría, que siguen el esquema de Gentoo. En mi caso creo que lo conveniente es "haiku-games". Dentro de esta carpeta creamos una con el nombre de nuestro paquete y allí almacenaremos la información sobre nuestro paquete. Estas carpetas deben tener al menos un archivo .recipe y pueden incluir las carpetas licenses y patches con licencias y parches adicionales respectivamente. En mi caso no usaremos ninguna de estas dos carpetas, así que creamos el archivo superfreecell-0.1.0.recipe . Es importante esta estructura para encontrar la versión fácilmente.<br><h2>El archivo .recipe</h2><br>El archivo .recipe contiene la información necesaria de metadatos e instrucciones para compilar e instalar el programa en cuestión.<br><br><br><pre class="lang:default decode:true"><br><br>SUMMARY=&amp;quot;Descripción de menos de 70 caracteres&amp;quot;<br>DESCRIPTION=&amp;quot;<br>Descripción extensa del programa usando \<br>para separar entre renglones que no deben superar \<br>los 80 caracteres<br>&amp;quot;<br>HOMEPAGE=&amp;quot;http://pagina-de-inicio.org.es&amp;quot;<br>SOURCE_URI=&amp;quot;http://una-pagina.com/con-el-archivo-del-codigo-fuente.tar.gz&amp;quot; # Se admiten muchas variaciones aquí. Podemos usar git://, hg://, svn://, bzr://, ftp://, http:// y los formatos de compresión tar.gz, tar.bz2, zip. Se admiten combinaciones de protocolos.<br>LICENSE=&amp;quot;MIT&amp;quot;<br>COPYRIGHT=&amp;quot;Año y autor&amp;quot;<br>REVISION=&amp;quot;1&amp;quot; # Siendo la misma versión del programa, revisiones del propio empaquetado<br>ARCHITECTURES=&amp;quot;?x86 x86_gcc2 !x86_64&amp;quot; # Arquitecturas compatibles, siendo x86_gcc2 estable, x86 sin probar (untested) pero que debería ir y x86_64 incompatible<br>if [ $effectiveTargetArchitecture != x86_gcc2 ]; then<br>ARCHITECTURES=&amp;quot;$ARCHITECTURES x86_gcc2&amp;quot;<br>fi<br>SECONDARY_ARCHITECTURES=&amp;quot;x86&amp;quot; # Arquitecturas secundarias<br>PROVIDES=&amp;quot;<br>miaplicacion$secondaryArchSuffix = $portVersion # Todos los paquetes se proveen a sí mismos<br>app:miaplicacion$secondaryArchSuffix = $portVersion # además es una aplicación de Haiku accesible desde los menús<br>&amp;quot;<br><br>REQUIRES=&amp;quot;<br>haiku$secondaryArchSuffix # Bastante claro. Aquí vendrían librerías en tiempo de ejecución<br>&amp;quot;<br><br>BUILD_REQUIRES=&amp;quot;<br>haiku_devel$secondaryArchSuffix # Actualmente todos los Haiku tienen haiku_devel pero por si las moscas. Aquí vendrían librerías de desarrollo<br>&amp;quot;<br><br>BUILD_PREREQUIRES=&amp;quot;<br>cmd:gcc$secondaryArchSuffix # Aquí vendrían las herramientas de línea de comandos. El prefijo cmd: indica que se llama desde la línea de comandos<br>cmd:ld$secondaryArchSuffix<br>cmd:make # Hay herramientas que da igual en que arquitectura estén para funcionar correctamente<br>&amp;quot;<br><br>SOURCE_DIR=&amp;quot;LA_CARPETA_CON_EL_CODIGO_FUENTE&amp;quot;<br><br>PATCH()<br>{<br># Aquí se ponen los parches que se puedan aplicar son sed<br>}<br>BUILD()<br>{<br># Las instrucciones de configuración y compilación. Si usamos autotools<br>runConfigure ./configure<br>make<br># Si usamos CMake<br>cmake .<br>make<br><br>}<br>INSTALL()<br>{<br># Los comandos para instalar la aplicación. Hay que tener cuidado con los directorios especiales de Haiku, que no son POSIX<br># Si usamos autotools y CMake<br>make install<br><br># También podemos copiar manualmente<br>mkdir -p $includeDir<br>cp include/libreria.h $includeDir/<br># Hay unas cuantas variables de carpetas que podemos usar<br><br>addAppDeskbarSymlink $appsDir/MiApplicacion<br># Es muy posible que el make install no instale los enlaces para mostrarse en el lanzador de aplicaciones de Haiku<br>}<br><br></pre><br><br><br>Y este sería el caso más básico de receta que podemos hacer. Si empaquetamos librerías la cosa se complica un poco más ya que tenemos que distinguir la parte de ejecución de la parte de desarrollo y entonces tendremos secciones como PROVIDES_devel que es especifico al paquete de desarrollo. Hay otra manera de aplicar parches que es con patchsets. Nosotros editamos la aplicación hasta que funcione y Haikuporter nos generará un archivo con los cambios que hay que aplicar a las fuentes. Es el mejor método para software un poco más complejo.<br><br><img class="alignnone size-large wp-image-110" src="https://files.adrianistan.eu/SuperFreeCell-Recipe-1024x768.png" alt="SuperFreeCell-Recipe" width="840" height="630" /><br><h2>Publicar cambios</h2><br>Una vez hayamos comprobado que funciona, lo subimos a nuestra copia de Git.<br><br><br><pre class="lang:default decode:true"><br><br>git add haiku-games/superfreecell<br>git commit -m &amp;quot;SuperFreeCell 0.1.0&amp;quot;<br>git push superfreecell master<br><br></pre><br><br><br>Y desde BitBucket hacemos una pull request o solicitud de integración