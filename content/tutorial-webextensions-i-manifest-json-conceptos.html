WebExtensions es un sistema para desarrollar extensiones de navegador. Realmente se trata de la API original de Google Chrome y Chromium. Esta API ya había sido diseñada teniendo en cuenta las extensiones de Firefox basadas en XUL y XPCOM. Simplifica mucho el proceso de tareas comunes, no requiere reinicios y es más segura al no permitir tanto control sobre el navegador.<br><br><img class="wp-image-498 size-full" src="https://files.adrianistan.eu/q036q.jpg" alt="WebExtensions" width="636" height="358" /> Tomada de http://tenfourfox.blogspot.com.es/2015/08/okay-you-want-webextensions-api.html<br><br>Posteriormente Firefox respondería con Jetpack y Addon SDK, un sistema similar pero escrito encima de XUL y XPCOM, incompatible pero que no necesitaba reinicios y tampoco perdía potencia pues las APIs de XPCOM seguían allí.<br><br>Luego Opera decide abandonar Presto y usar Blink, el motor de Chromium. Con respecto a su sistema de extensiones, planean ser 100% compatibles con Chrome.<br><br>Firefox también ha de realizar cambios internos, concretamente se inició el trabajo (electrolysis) de hacer Firefix multiproceso. Esto rompía gran parte de las APIs internas de Firefox. Todos los complementos necesitarían ser reescritos. Ya de paso, teniendo en cuenta que hay que diseñar una nueva API para extensiones, se toma la de Chrome y se renombra WebExtensions. Posteriormente <a href="https://developer.microsoft.com/en-us/microsoft-edge/platform/documentation/extensions/">Microsoft afirma que Edge</a> será compatible con extensiones de Chrome o WebExtensions. Esta es la historia de como 4 navegadores se pusieron de acuerdo en estandarizar la API de desarrollo de extensiones para navegadores.<br><br>En esta serie de tutoriales vamos a ver como programar nuestra extensión usando WebExtensions.<br><h2>manifest.json</h2><br>El fichero manifest.json de una extensión es muy importante y es obligatorio. Contiene metadatos de la extensión así como permisos de los que dispone la extensión y las acciones que define.<br><br>En primer lugar vamos a distinguir entre distintos tipos de scripts distintos.<br><ul><br> 	<li>Background scripts: estos scripts se ejecutan en el <em>fondo</em> del navegador. Se ejecutan al iniciar el navegador. Podemos configurar eventos y entonces se mantendrán a la escucha durante toda la sesión. Estos scripts no pueden acceder a las páginas web.</li><br> 	<li>Content scripts: estos scripts se añaden a determinadas páginas según un patrón en el archivo manifest.json o desde un background script. Estos scripts interactúan directamente con las páginas en los que han sido <em>adjuntados</em>.</li><br></ul><br>Veamos ahora un fichero manifest.json<br><br>&nbsp;<br><br><pre class="lang:js decode:true"><br>{<br>	&quot;manifest_version&quot; : 2,<br>	&quot;name&quot; : &quot;Bc.vc shortener&quot;,<br>	&quot;version&quot; : &quot;2.0.0&quot;,<br>	&quot;description&quot; : &quot;Shorthener for Bc.vc&quot;,<br>	&quot;homepage_url&quot; : &quot;http://adrianistan.eu/norax/&quot;,<br>	&quot;icons&quot; : {<br>		&quot;16&quot; : &quot;icon-16.png&quot;,<br>		&quot;48&quot; : &quot;icon-48.png&quot;,<br>		&quot;64&quot; : &quot;icon-64.png&quot;,<br>		&quot;96&quot; : &quot;icon-96.png&quot;,<br>		&quot;128&quot; : &quot;icon-128.png&quot;<br>	},<br>	&quot;applications&quot; : {<br>		&quot;gecko&quot; : {<br>			&quot;id&quot; : &quot;@bc-vc&quot;,<br>			&quot;strict_min_version&quot; : &quot;45.*&quot;<br>		}<br>	},<br>	&quot;permissions&quot; : [&quot;notifications&quot;,&quot;contextMenus&quot;,&quot;clipboardWrite&quot;,&quot;activeTab&quot;,&quot;storage&quot;,&quot;http://bc.vc/&quot;],<br>	&quot;browser_action&quot; : {<br>		&quot;default_title&quot; : &quot;Bc.vc shortener&quot;,<br>		&quot;default_icon&quot; : &quot;icon-64.png&quot;<br>	},<br>	&quot;background&quot; : {<br>		&quot;scripts&quot; : [&quot;background/install.js&quot;,&quot;background/main.js&quot;]<br>	},<br>	&quot;options_ui&quot; : {<br>		&quot;page&quot; : &quot;options/options.html&quot;,<br>		&quot;chrome_style&quot; : true<br>	}<br>}<br></pre><br><br>manifest_version siempre es 2. Al principio rellenamos metadatos sencillos, name, description, version, homepage_url,... Posteriormente debemos añadir los iconos. Dependiendo de lo que queramos no hacen falta todos los iconos. Por ejemplo, el icono de 16x16 solo es necesario si nuestra extensión define un menú contextual del botón derecho. La sección applications ha sido añadida por Mozilla y originalmente no está en Chrome. Define la compatibilidad entre distintos navegadores y versiones, sin embargo, por ahora solo Firefox tiene en cuenta esto.<br><br>A continuación se definen los permisos. Una extensión necesita pedir permiso para acceder a ciertas APIs más privilegiadas. Por ejemplo, para mostrar notificaciones o para realizar peticiones HTTP a servidores remotos.<br><br>A continuación vemos la <em>acción del navegador</em>. A diferencia de otros sistemas de extensiones, WebExtensiones solo permite un botón en la interfaz del navegador. Es una manera excelente de separar funcionalidades, aunque si vienes de Firefox verás como limita a muchas extensiones, algunas de las cuáles modificaban la interfaz por completo. La acción del navegador puede hacer dos cosas: abrir un panel popup o generar un evento en el background script. Dependiendo de como sea la experiencia de usuario que prefieras te convendrá una opción u otra (en este caso, como no hemos definido un popup html <em>default_popup</em>, tendremos que escuchar el evento browserAction en un background script). Similar a <em>browser_action</em> existe <em>page_action</em>, la única diferencia es el lugar donde aparece el botón.<br><br><img src="http://i.stack.imgur.com/k0Ayh.png" width="184" height="87" /> Page Action a la izquierda<br><br><img src="http://i.stack.imgur.com/UL65l.png" width="400" height="38" /> Browser Action a la derecha<br><br>Después podemos asignar archivos de background scripts. Por último <em>options_ui</em> es la manera adecuada de crear una página de opciones. Será una página HTML, pero de eso hablaremos en otro tutorial.<br><br>Por último vamos a ver los content scripts<br><br><pre class="lang:js decode:true"><br>&quot;content_scripts&quot;: [<br>  {<br>    &quot;matches&quot;: [&quot;*://*.mozilla.org/*&quot;],<br>    &quot;js&quot;: [&quot;borderify.js&quot;],<br>    &quot;css&quot; : [&quot;style.css&quot;],<br>    &quot;all_frames&quot; : false,<br>    &quot;run_at&quot; : &quot;document_end&quot;<br>  }<br>]<br></pre><br><br>Una manera de añadir content scripts es desde el manifest.json, especificando un patrón en <em>matches</em>. Podemos añadir JavaScript y CSS.<br><br>Otra opción es <em>web_accesible_resources</em>. Se trata de elementos de la extensión que pueden ser cargados desde una página web. Por ejemplo, si un content script quiere mostrar una imagen en una web, esta deberá estar indicada en web_accesible_resources.<br><br><pre class="lang:js decode:true"><br>&quot;web_accesible_resources&quot; : [&quot;imagen/zorro.png&quot;]<br><br>...<br><br>chrome.extension.getURL(&quot;imagen/zorro.png&quot;); // desde el content script<br></pre><br><br>Este fichero es el más importante de una WebExtension. En el siguiente tutorial veremos los background scripts combinados con browser actions.